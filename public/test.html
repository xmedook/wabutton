<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Widget Button Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .config-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="color"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .code-section {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        #code-output {
            background: #fff;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>WhatsApp Widget Button Test</h1>
    
    <div class="config-section">
        <h2>Configuration</h2>
        <div class="form-group">
            <label for="whatsapp">WhatsApp Number (with country code, no spaces or symbols):</label>
            <input type="text" id="whatsapp" value="15593633137">
        </div>
        <div class="form-group">
            <label for="call-to-action">Tooltip Text:</label>
            <input type="text" id="call-to-action" value="Chat with us on WhatsApp">
        </div>
        <div class="form-group">
            <label for="button-color">Button Color:</label>
            <input type="color" id="button-color" value="#25D366">
        </div>
        <div class="form-group">
            <label for="position">Button Position:</label>
            <select id="position">
                <option value="right">Right</option>
                <option value="left">Left</option>
            </select>
        </div>
        <div class="form-group">
            <label for="pre-filled-message">Pre-filled Message:</label>
            <input type="text" id="pre-filled-message" value="Hola, necesito información acerca de los productos">
        </div>
        <button id="apply-button">Apply Changes</button>
    </div>

    <div class="code-section">
        <h2>Generated Code</h2>
        <p>Copy and paste this code into your website:</p>
        <pre id="code-output"></pre>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var config = {
                widgetId: '67f762a9cfb9a6321c0260fa',
                whatsapp: '15593633137',
                call_to_action: 'Chat with us on WhatsApp',
                button_color: '#25D366',
                position: 'right',
                pre_filled_message: 'Hola, necesito información acerca de los productos'
            };
            
            // Initialize widget with default config
            WhWidgetSendButton.init(config.widgetId, config);
            
            // Update code display
            updateCodeDisplay();
            
            // Apply button click handler
            document.getElementById('apply-button').addEventListener('click', function() {
                // Remove existing widget
                var existingWidget = document.querySelector('.wa-widget-send-button');
                if (existingWidget) {
                    existingWidget.remove();
                }
                
                // Update config from form
                config.whatsapp = document.getElementById('whatsapp').value;
                config.call_to_action = document.getElementById('call-to-action').value;
                config.button_color = document.getElementById('button-color').value;
                config.position = document.getElementById('position').value;
                config.pre_filled_message = document.getElementById('pre-filled-message').value;
                
                // Initialize widget with new config
                WhWidgetSendButton.init(config.widgetId, config);
                
                // Update code display
                updateCodeDisplay();
            });
            
            function updateCodeDisplay() {
                var codeOutput = document.getElementById('code-output');
                var code = [
                    '<!-- WhatsApp Widget Button -->',
                    '<script>',
                    '(function() {',
                    '    var options = {',
                    '        widgetId: "' + config.widgetId + '",',
                    '        whatsapp: "' + config.whatsapp + '",',
                    '        call_to_action: "' + config.call_to_action + '",',
                    '        button_color: "' + config.button_color + '",',
                    '        position: "' + config.position + '",',
                    '        pre_filled_message: "' + config.pre_filled_message + '"',
                    '    };',
                    '    var proto = document.location.protocol,',
                    '        host = "wabutton.nexodigital.ai",',
                    '        url = proto + "//" + host;',
                    '    var s = document.createElement("script");',
                    '    s.type = "text/javascript";',
                    '    s.async = true;',
                    '    s.src = url + "/widget.js";',
                    '    s.onload = function() {',
                    '        WhWidgetSendButton.init(options.widgetId, options);',
                    '    };',
                    '    var x = document.getElementsByTagName("script")[0];',
                    '    x.parentNode.insertBefore(s, x);',
                    '})();',
                    '</' + 'script>',
                    '<!-- /WhatsApp Widget Button -->'
                ].join('\n');
                
                codeOutput.textContent = code;
            }
        });
    </script>
    <script src="/widget.js"></script>
</body>
</html>
